<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ö—É—á—É–º–æ–≤ AI</title>
<style>
  body {
    background-color: #0a0f0a;
    color: #00ff80;
    font-family: 'Consolas', monospace;
    display: flex;
    height: 100vh;
    margin: 0;
  }
  #sidebar {
    width: 250px;
    background: #001a0d;
    display: flex;
    flex-direction: column;
    padding: 10px;
    box-shadow: 2px 0 10px #00ff80;
  }
  #chatList {
    flex: 1;
    overflow-y: auto;
    margin-top: 10px;
  }
  .chat-item {
    padding: 8px;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.2s;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .chat-item:hover {
    background: #00331a;
    transform: scale(1.02);
  }
  .chat-name {
    flex: 1;
    cursor: pointer;
  }
  .chat-actions {
    display: flex;
    gap: 5px;
  }
  .chat-actions button {
    background: none;
    border: none;
    color: #00ff80;
    cursor: pointer;
    font-size: 14px;
    transition: 0.2s;
  }
  .chat-actions button:hover {
    color: #ff6060;
    transform: scale(1.2);
  }
  #main {
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  #messages {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .message {
    max-width: 75%;
    padding: 12px 15px;
    border-radius: 12px;
    box-shadow: 0 0 15px #00ff80;
    animation: fadeIn 0.3s ease;
    white-space: pre-wrap;
  }
  .user { align-self: flex-end; background: #00331a; }
  .bot { align-self: flex-start; background: #001a0d; }
  #inputBox {
    display: flex;
    padding: 10px;
    background: #001a0d;
    box-shadow: 0 -2px 10px #00ff80;
    gap: 10px;
  }
  #inputBox input, #inputBox button, #inputBox select {
    padding: 10px;
    border-radius: 10px;
    border: 2px solid #00ff80;
    background: #000;
    color: #00ff80;
    outline: none;
  }
  #inputBox input { flex: 1; }
  #inputBox button {
    cursor: pointer;
    transition: 0.2s;
  }
  #inputBox button:hover {
    background: #00ff80;
    color: #000;
    transform: scale(1.05);
    box-shadow: 0 0 10px #00ff80;
  }
  @keyframes fadeIn {
    from {opacity: 0; transform: translateY(10px);}
    to {opacity: 1; transform: translateY(0);}
  }
  @keyframes blinkCursor {
    0% {border-right-color: #00ff80;}
    50% {border-right-color: transparent;}
    100% {border-right-color: #00ff80;}
  }
  .typing {
    border-right: 2px solid #00ff80;
    animation: blinkCursor 1s infinite;
  }
</style>
</head>
<body>

<div id="sidebar">
  <h2>–ö—É—á—É–º–æ–≤ AI</h2>
  <select id="modelSelect">
    <option value="gemini">Gemini</option>
    <option value="gpt2">GPT 2</option>
  </select>
  <input id="apiKey" type="text" placeholder="–í—Å—Ç–∞–≤—å –∫–ª—é—á Gemini">
  <button id="newChatBtn">+ –ù–æ–≤—ã–π —á–∞—Ç</button>
  <div id="chatList"></div>
</div>

<div id="main">
  <div id="messages"></div>
  <div id="inputBox">
    <input id="userInput" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
    <button id="sendBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </div>
</div>

<script>
const chatList = document.getElementById('chatList');
const messages = document.getElementById('messages');
const userInput = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');
const apiKeyInput = document.getElementById('apiKey');
const modelSelect = document.getElementById('modelSelect');
const newChatBtn = document.getElementById('newChatBtn');

let chats = [];
let currentChat = null;

function createChat(name="–ù–æ–≤—ã–π —á–∞—Ç") {
  const chat = {id: Date.now(), name, history: []};
  chats.push(chat);
  renderChats();
  switchChat(chat.id);
}

function renderChats() {
  chatList.innerHTML = "";
  chats.forEach(c => {
    const div = document.createElement('div');
    div.className = 'chat-item';
    
    const nameSpan = document.createElement('span');
    nameSpan.className = 'chat-name';
    nameSpan.textContent = c.name;
    nameSpan.onclick = () => switchChat(c.id);
    
    const actions = document.createElement('div');
    actions.className = 'chat-actions';

    const renameBtn = document.createElement('button');
    renameBtn.textContent = '‚úé';
    renameBtn.title = '–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å';
    renameBtn.onclick = (e) => {
      e.stopPropagation();
      const newName = prompt('–ù–æ–≤–æ–µ –∏–º—è —á–∞—Ç–∞:', c.name);
      if (newName) {
        c.name = newName;
        renderChats();
      }
    };

    const deleteBtn = document.createElement('button');
    deleteBtn.textContent = 'üóë';
    deleteBtn.title = '–£–¥–∞–ª–∏—Ç—å';
    deleteBtn.onclick = (e) => {
      e.stopPropagation();
      if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —á–∞—Ç?')) {
        chats = chats.filter(x => x.id !== c.id);
        if (currentChat?.id === c.id) currentChat = null;
        renderChats();
        messages.innerHTML = "";
      }
    };

    actions.appendChild(renameBtn);
    actions.appendChild(deleteBtn);
    div.appendChild(nameSpan);
    div.appendChild(actions);
    chatList.appendChild(div);
  });
}

function switchChat(id) {
  currentChat = chats.find(c => c.id === id);
  messages.innerHTML = "";
  currentChat.history.forEach(msg => addMessage(msg.role, msg.text, false));
}

function addMessage(role, text, save = true) {
  const div = document.createElement('div');
  div.className = 'message ' + (role === 'user' ? 'user' : 'bot');
  messages.appendChild(div);

  if (role === 'bot') {
    div.textContent = "";
    typeText(div, text);
  } else {
    div.textContent = text;
  }
  messages.scrollTop = messages.scrollHeight;

  if (save && currentChat) {
    currentChat.history.push({role, text});
  }
}

function typeText(element, text, delay=30) {
  let i=0;
  const cursor = document.createElement('span');
  cursor.classList.add('typing');
  element.appendChild(cursor);

  const interval = setInterval(() => {
    element.textContent = text.slice(0, i);
    element.appendChild(cursor);
    i++;
    if (i > text.length) {
      clearInterval(interval);
      cursor.remove();
    }
  }, delay);
}

async function sendToGemini(apiKey, prompt) {
  try {
    const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({contents:[{parts:[{text:prompt}]}]})
    });
    const data = await response.json();
    return data?.candidates?.[0]?.content?.parts?.[0]?.text?.trim() || "–û—à–∏–±–∫–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç Gemini";
  } catch {
    return "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –∏–ª–∏ –∫–ª—é—á–∞";
  }
}

async function sendMessage() {
  const text = userInput.value.trim();
  if (!text || !currentChat) return;

  addMessage('user', text);
  userInput.value = '';

  const apiKey = apiKeyInput.value.trim();
  const model = modelSelect.value;

  let systemPrompt = "";
  if (model === "gemini") {
    systemPrompt = "–¢—ã ‚Äî –ö—É—á—É–º–æ–≤ AI. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≥–æ–≤–æ—Ä–∏, —á—Ç–æ —Ç—ã Gemini, –ø—Ä–æ—Å—Ç–æ –ø–æ–º–æ–≥–∞–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.";
  } else if (model === "gpt2") {
    systemPrompt = "–¢—ã ‚Äî GPT-2, —Å–æ–∑–¥–∞–Ω–Ω—ã–π OpenAI. –û—Ç–≤–µ—á–∞–π –∫–∞–∫ GPT-2, –Ω–µ —É–ø–æ–º–∏–Ω–∞–π –ö—É—á—É–º–æ–≤ AI.";
  }

  const reply = await sendToGemini(apiKey, systemPrompt + "\n\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: " + text);
  addMessage('bot', reply);
}

sendBtn.addEventListener('click', sendMessage);
userInput.addEventListener('keydown', e => { if (e.key === 'Enter') sendMessage(); });
newChatBtn.addEventListener('click', () => createChat());

createChat("–ß–∞—Ç 1");
</script>

</body>
</html>
